/* NicEdit - Micro Inline WYSIWYG
 * Copyright 2007-2008 Brian Kirchoff
 *
 * NicEdit is distributed under the terms of the MIT license
 * For more information visit http://nicedit.com/
 * Do not remove this copyright message
 */
function bkClass(){}function $BK(e){if("string"==typeof e)e=document.getElementById(e);return e&&!e.appendTo?bkExtend(e,bkElement.prototype):e}function __(e){return e}var bkExtend=function(){var e=arguments;if(1==e.length)e=[this,e[0]];for(var t in e[1])e[0][t]=e[1][t];return e[0]};bkClass.prototype.construct=function(){};bkClass.extend=function(e){var t=function(){if(arguments[0]!==bkClass)return this.construct.apply(this,arguments)};var n=new this(bkClass);bkExtend(n,e);t.prototype=n;t.extend=this.extend;return t};var bkElement=bkClass.extend({construct:function(e,t){if("string"==typeof e)e=(t||document).createElement(e);e=$BK(e);return e},appendTo:function(e){e.appendChild(this);return this},appendBefore:function(e){e.parentNode.insertBefore(this,e);return this},addEvent:function(e,t){bkLib.addEvent(this,e,t);return this},setContent:function(e){this.innerHTML=e;return this},pos:function(){var e=curtop=0;var t=obj=this;if(obj.offsetParent)do{e+=obj.offsetLeft;curtop+=obj.offsetTop}while(obj=obj.offsetParent);var n=!window.opera?parseInt(this.getStyle("border-width")||this.style.border)||0:0;return[e+n,curtop+n+this.offsetHeight]},noSelect:function(){bkLib.noSelect(this);return this},parentTag:function(e){var t=this;do{if(t&&t.nodeName&&t.nodeName.toUpperCase()==e)return t;t=t.parentNode}while(t);return false},hasClass:function(e){return this.className.match(new RegExp("(\\s|^)nicEdit-"+e+"(\\s|$)"))},addClass:function(e){if(!this.hasClass(e))this.className+=" nicEdit-"+e;return this},removeClass:function(e){if(this.hasClass(e))this.className=this.className.replace(new RegExp("(\\s|^)nicEdit-"+e+"(\\s|$)")," ");return this},setStyle:function(e){var t=this.style;for(var n in e)switch(n){case"float":t.cssFloat=t.styleFloat=e[n];break;case"opacity":t.opacity=e[n];t.filter="alpha(opacity="+Math.round(100*e[n])+")";break;case"className":this.className=e[n];break;default:t[n]=e[n]}return this},getStyle:function(e,t){var n=!t?document.defaultView:t;if(1==this.nodeType)return n&&n.getComputedStyle?n.getComputedStyle(this,null).getPropertyValue(e):this.currentStyle[bkLib.camelize(e)]},remove:function(){this.parentNode.removeChild(this);return this},setAttributes:function(e){for(var t in e)this[t]=e[t];return this}});var bkLib={isMSIE:navigator.appVersion.indexOf("MSIE")!=-1,addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,false):e.attachEvent("on"+t,n)},toArray:function(e){var t=e.length,n=new Array(t);while(t--)n[t]=e[t];return n},noSelect:function(e){if(e.setAttribute&&"input"!=e.nodeName.toLowerCase()&&"textarea"!=e.nodeName.toLowerCase())e.setAttribute("unselectable","on");for(var t=0;t<e.childNodes.length;t++)bkLib.noSelect(e.childNodes[t])},camelize:function(e){return e.replace(/\-(.)/g,function(e,t){return t.toUpperCase()})},inArray:function(e,t){return null!=bkLib.search(e,t)},search:function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return n;return null},cancelEvent:function(e){e=e||window.event;if(e.preventDefault&&e.stopPropagation){e.preventDefault();e.stopPropagation()}return false},domLoad:[],domLoaded:function(){if(arguments.callee.done)return;arguments.callee.done=true;for(i=0;i<bkLib.domLoad.length;i++)bkLib.domLoad[i]()},onDomLoaded:function(e){this.domLoad.push(e);if(document.addEventListener)document.addEventListener("DOMContentLoaded",bkLib.domLoaded,null);else if(bkLib.isMSIE){document.write("<style>.nicEdit-main p { margin: 0; }</style><script id=__ie_onload defer "+("https:"==location.protocol?"src='javascript:void(0)'":"src=//0")+"></script>");$BK("__ie_onload").onreadystatechange=function(){if("complete"==this.readyState)bkLib.domLoaded()}}window.onload=bkLib.domLoaded}};var bkEvent={addEvent:function(e,t){if(t){this.eventList=this.eventList||{};this.eventList[e]=this.eventList[e]||[];this.eventList[e].push(t)}return this},fireEvent:function(){var e=bkLib.toArray(arguments),t=e.shift();if(this.eventList&&this.eventList[t])for(var n=0;n<this.eventList[t].length;n++)this.eventList[t][n].apply(this,e)}};Function.prototype.closure=function(){var e=this,t=bkLib.toArray(arguments),n=t.shift();return function(){if("undefined"!=typeof bkLib)return e.apply(n,t.concat(bkLib.toArray(arguments)))}};Function.prototype.closureListener=function(){var e=this,t=bkLib.toArray(arguments),n=t.shift();return function(r){r=r||window.event;if(r.target)var i=r.target;else var i=r.srcElement;return e.apply(n,[r,i].concat(t))}};var nicEditorConfig=bkClass.extend({buttons:{bold:{name:__("Click to Bold"),command:"Bold",tags:["B","STRONG"],css:{"font-weight":"bold"},key:"b"},italic:{name:__("Click to Italic"),command:"Italic",tags:["EM","I"],css:{"font-style":"italic"},key:"i"},underline:{name:__("Click to Underline"),command:"Underline",tags:["U"],css:{"text-decoration":"underline"},key:"u"},left:{name:__("Left Align"),command:"justifyleft",noActive:true},center:{name:__("Center Align"),command:"justifycenter",noActive:true},right:{name:__("Right Align"),command:"justifyright",noActive:true},justify:{name:__("Justify Align"),command:"justifyfull",noActive:true},ol:{name:__("Insert Ordered List"),command:"insertorderedlist",tags:["OL"]},ul:{name:__("Insert Unordered List"),command:"insertunorderedlist",tags:["UL"]},subscript:{name:__("Click to Subscript"),command:"subscript",tags:["SUB"]},superscript:{name:__("Click to Superscript"),command:"superscript",tags:["SUP"]},strikethrough:{name:__("Click to Strike Through"),command:"strikeThrough",css:{"text-decoration":"line-through"}},removeformat:{name:__("Remove Formatting"),command:"removeformat",noActive:true},indent:{name:__("Indent Text"),command:"indent",noActive:true},outdent:{name:__("Remove Indent"),command:"outdent",noActive:true},hr:{name:__("Horizontal Rule"),command:"insertHorizontalRule",noActive:true}},iconsPath:"images/nicEditorIcons.gif",buttonList:["save","bold","italic","underline","left","center","right","justify","ol","ul","fontSize","fontFamily","fontFormat","indent","outdent","image","upload","link","unlink","forecolor","bgcolor","removeformat"],iconList:{xhtml:1,bgcolor:2,forecolor:3,bold:4,center:5,hr:6,indent:7,italic:8,justify:9,left:10,ol:11,outdent:12,removeformat:13,right:14,save:25,strikethrough:16,subscript:17,superscript:18,ul:19,underline:20,image:21,link:22,unlink:23,close:24,arrow:26,upload:27}});var nicEditors={nicPlugins:[],editors:[],registerPlugin:function(e,t){this.nicPlugins.push({p:e,o:t})},allTextAreas:function(e){var t=document.getElementsByTagName("textarea");for(var n=0;n<t.length;n++)nicEditors.editors.push((new nicEditor(e)).panelInstance(t[n]));return nicEditors.editors},findEditor:function(e){var t=nicEditors.editors;for(var n=0;n<t.length;n++)if(t[n].instanceById(e))return t[n].instanceById(e)}};var nicEditor=bkClass.extend({construct:function(e){this.options=new nicEditorConfig;bkExtend(this.options,e);this.nicInstances=new Array;this.loadedPlugins=new Array;var t=nicEditors.nicPlugins;for(var n=0;n<t.length;n++)this.loadedPlugins.push(new t[n].p(this,t[n].o));nicEditors.editors.push(this);bkLib.addEvent(document.body,"mousedown",this.selectCheck.closureListener(this))},panelInstance:function(e,t){e=this.checkReplace($BK(e));var n=(new bkElement("DIV")).setStyle({width:(parseInt(e.getStyle("width"))||e.clientWidth)+"px"}).appendBefore(e);this.setPanel(n);return this.addInstance(e,t)},checkReplace:function(e){var t=nicEditors.findEditor(e);if(t){t.removeInstance(e);t.removePanel()}return e},addInstance:function(e,t){e=this.checkReplace($BK(e));if(e.contentEditable||!!window.opera)var n=new nicEditorInstance(e,t,this);else var n=new nicEditorIFrameInstance(e,t,this);this.nicInstances.push(n);return this},removeInstance:function(e){e=$BK(e);var t=this.nicInstances;for(var n=0;n<t.length;n++)if(t[n].e==e){t[n].remove();this.nicInstances.splice(n,1)}},removePanel:function(e){if(this.nicPanel){this.nicPanel.remove();this.nicPanel=null}},instanceById:function(e){e=$BK(e);var t=this.nicInstances;for(var n=0;n<t.length;n++)if(t[n].e==e)return t[n]},setPanel:function(e){this.nicPanel=new nicEditorPanel($BK(e),this.options,this);this.fireEvent("panel",this.nicPanel);return this},nicCommand:function(e,t){if(this.selectedInstance)this.selectedInstance.nicCommand(e,t)},getIcon:function(e,t){var n=this.options.iconList[e];var r=t.iconFiles?t.iconFiles[e]:"";return{backgroundImage:"url('"+(n?this.options.iconsPath:r)+"')",backgroundPosition:(n?(n-1)*-18:0)+"px 0px"}},selectCheck:function(e,t){var n=false;do if(t.className&&t.className.indexOf("nicEdit")!=-1)return false;while(t=t.parentNode);this.fireEvent("blur",this.selectedInstance,t);this.lastSelectedInstance=this.selectedInstance;this.selectedInstance=null;return false}});nicEditor=nicEditor.extend(bkEvent);var nicEditorInstance=bkClass.extend({isSelected:false,construct:function(e,t,n){this.ne=n;this.elm=this.e=e;this.options=t||{};newX=parseInt(e.getStyle("width"))||e.clientWidth;newY=parseInt(e.getStyle("height"))||e.clientHeight;this.initialHeight=newY-2;var r="textarea"==e.nodeName.toLowerCase();if(r||this.options.hasPanel){var i=bkLib.isMSIE&&!("undefined"!=typeof document.body.style.maxHeight&&"CSS1Compat"==document.compatMode);var s={width:newX-6+"px",border:"1px solid gray",backgroundColor:"gray",borderTop:0,overflowY:"auto",overflowX:"hidden"};s[i?"height":"maxHeight"]=this.ne.options.maxHeight?this.ne.options.maxHeight+"px":null;this.editorContain=(new bkElement("DIV")).setStyle(s).appendBefore(e);var o=(new bkElement("DIV")).setStyle({outline:"none",width:newX-8+"px",margin:"1px",minHeight:newY+"px"}).addClass("main").appendTo(this.editorContain);e.setStyle({display:"none"});o.innerHTML=e.innerHTML;if(r){o.setContent(e.value);this.copyElm=e;var u=e.parentTag("FORM");if(u)bkLib.addEvent(u,"submit",this.saveContent.closure(this))}o.setStyle(i?{height:newY+"px"}:{overflow:"hidden"});this.elm=o}this.ne.addEvent("blur",this.blur.closure(this));this.init();this.blur()},init:function(){this.elm.setAttribute("contentEditable","true");if(""==this.getContent())this.setContent("<br />");this.instanceDoc=document.defaultView;this.elm.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keypress",this.keyDown.closureListener(this)).addEvent("focus",this.selected.closure(this)).addEvent("blur",this.blur.closure(this)).addEvent("keyup",this.selected.closure(this));this.ne.fireEvent("add",this)},remove:function(){this.saveContent();if(this.copyElm||this.options.hasPanel){this.editorContain.remove();this.e.setStyle({display:"block"});this.ne.removePanel()}this.disable();this.ne.fireEvent("remove",this)},disable:function(){this.elm.setAttribute("contentEditable","false")},getSel:function(){return window.getSelection?window.getSelection():document.selection},getRng:function(){var e=this.getSel();if(!e||0===e.rangeCount)return;return e.rangeCount>0?e.getRangeAt(0):e.createRange()},selRng:function(e,t){if(window.getSelection){t.removeAllRanges();t.addRange(e)}else e.select()},selElm:function(){var e=this.getRng();if(!e)return;if(e.startContainer){var t=e.startContainer;if(1==e.cloneContents().childNodes.length)for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n].ownerDocument.createRange();r.selectNode(t.childNodes[n]);if(1!=e.compareBoundaryPoints(Range.START_TO_START,r)&&e.compareBoundaryPoints(Range.END_TO_END,r)!=-1)return $BK(t.childNodes[n])}return $BK(t)}else return $BK("Control"==this.getSel().type?e.item(0):e.parentElement())},saveRng:function(){this.savedRange=this.getRng();this.savedSel=this.getSel()},restoreRng:function(){if(this.savedRange)this.selRng(this.savedRange,this.savedSel)},keyDown:function(e,t){if(e.ctrlKey)this.ne.fireEvent("key",this,e)},selected:function(e,t){if(!t&&!(t=this.selElm))t=this.selElm();if(!e.ctrlKey){var n=this.ne.selectedInstance;if(n!=this){if(n)this.ne.fireEvent("blur",n,t);this.ne.selectedInstance=this;this.ne.fireEvent("focus",n,t)}this.ne.fireEvent("selected",n,t);this.isFocused=true;this.elm.addClass("selected");this.elm.style.background="#D9F4C3"}return false},blur:function(){this.isFocused=false;this.elm.removeClass("selected");this.elm.style.background="white"},saveContent:function(){if(this.copyElm||this.options.hasPanel){this.ne.fireEvent("save",this);this.copyElm?this.copyElm.value=this.getContent():this.e.innerHTML=this.getContent()}},getElm:function(){return this.elm},getContent:function(){this.content=this.getElm().innerHTML;this.ne.fireEvent("get",this);return this.content},setContent:function(e){this.content=e;this.ne.fireEvent("set",this);this.elm.innerHTML=this.content},nicCommand:function(e,t){document.execCommand(e,false,t)}});var nicEditorIFrameInstance=nicEditorInstance.extend({savedStyles:[],init:function(){var e=this.elm.innerHTML.replace(/^\s+|\s+$/g,"");this.elm.innerHTML="";!e?e="<br />":e;this.initialContent=e;this.elmFrame=(new bkElement("iframe")).setAttributes({src:"javascript:;",frameBorder:0,allowTransparency:"true",scrolling:"no"}).setStyle({height:"100px",width:"100%"}).addClass("frame").appendTo(this.elm);if(this.copyElm)this.elmFrame.setStyle({width:this.elm.offsetWidth-4+"px"});var t=["font-size","font-family","font-weight","color"];for(itm in t)this.savedStyles[bkLib.camelize(itm)]=this.elm.getStyle(itm);setTimeout(this.initFrame.closure(this),50)},disable:function(){this.elm.innerHTML=this.getContent()},initFrame:function(){var e=$BK(this.elmFrame.contentWindow.document);e.designMode="on";e.open();var t=this.ne.options.externalCSS;e.write("<html><head>"+(t?'<link href="'+t+'" rel="stylesheet" type="text/css" />':"")+'</head><body id="nicEditContent" style="margin: 0 !important; background-color: transparent !important;">'+this.initialContent+"</body></html>");e.close();this.frameDoc=e;this.frameWin=$BK(this.elmFrame.contentWindow);this.frameContent=$BK(this.frameWin.document.body).setStyle(this.savedStyles);this.instanceDoc=this.frameWin.document.defaultView;this.heightUpdate();this.frameDoc.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keyup",this.heightUpdate.closureListener(this)).addEvent("keydown",this.keyDown.closureListener(this)).addEvent("keyup",this.selected.closure(this));this.ne.fireEvent("add",this)},getElm:function(){return this.frameContent},setContent:function(e){this.content=e;this.ne.fireEvent("set",this);this.frameContent.innerHTML=this.content;this.heightUpdate()},getSel:function(){return this.frameWin?this.frameWin.getSelection():this.frameDoc.selection},heightUpdate:function(){this.elmFrame.style.height=Math.max(this.frameContent.offsetHeight,this.initialHeight)+"px"},nicCommand:function(e,t){this.frameDoc.execCommand(e,false,t);setTimeout(this.heightUpdate.closure(this),100)}});var nicEditorPanel=bkClass.extend({construct:function(e,t,n){this.elm=e;this.options=t;this.ne=n;this.panelButtons=new Array;this.buttonList=bkExtend([],this.ne.options.buttonList);this.panelContain=(new bkElement("DIV")).setStyle({overflow:"hidden",width:"100%",border:"0px solid #cccccc"}).addClass("panelContain");this.panelElm=(new bkElement("DIV")).setStyle({margin:"2px",marginTop:"0px",zoom:1,overflow:"hidden"}).addClass("panel").appendTo(this.panelContain);this.panelContain.appendTo(e);var r=this.ne.options;var i=r.buttons;for(button in i)this.addButton(button,r,true);this.reorder();e.noSelect()},addButton:function(buttonName,options,noOrder){var button=options.buttons[buttonName];var type=button.type?eval("(typeof("+button.type+') == "undefined") ? null : '+button.type+";"):nicEditorButton;var hasButton=bkLib.inArray(this.buttonList,buttonName);if(type&&(hasButton||this.ne.options.fullPanel)){this.panelButtons.push(new type(this.panelElm,buttonName,options,this.ne));if(!hasButton)this.buttonList.push(buttonName)}},findButton:function(e){for(var t=0;t<this.panelButtons.length;t++)if(this.panelButtons[t].name==e)return this.panelButtons[t]},reorder:function(){var e=this.buttonList;for(var t=0;t<e.length;t++){var n=this.findButton(e[t]);if(n)this.panelElm.appendChild(n.margin)}},remove:function(){this.elm.remove()}});var nicEditorButton=bkClass.extend({construct:function(e,t,n,r){this.options=n.buttons[t];this.name=t;this.ne=r;this.elm=e;this.margin=(new bkElement("DIV")).setStyle({"float":"left",marginTop:"2px"}).appendTo(e);this.contain=(new bkElement("DIV")).setStyle({width:"20px",height:"20px"}).addClass("buttonContain").appendTo(this.margin);this.border=(new bkElement("DIV")).setStyle({border:"1px solid #efefef"}).appendTo(this.contain);this.button=(new bkElement("DIV")).setStyle({width:"18px",height:"18px",overflow:"hidden",zoom:1,cursor:"pointer"}).addClass("button").setStyle(this.ne.getIcon(t,n)).appendTo(this.border);this.button.addEvent("mouseover",this.hoverOn.closure(this)).addEvent("mouseout",this.hoverOff.closure(this)).addEvent("mousedown",this.mouseClick.closure(this)).noSelect();if(!window.opera)this.button.onmousedown=this.button.onclick=bkLib.cancelEvent;r.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this)).addEvent("key",this.key.closure(this));this.disable();this.init()},init:function(){},hide:function(){this.contain.setStyle({display:"none"})},updateState:function(){if(this.isDisabled)this.setBg();else if(this.isHover)this.setBg("hover");else if(this.isActive)this.setBg("active");else this.setBg()},setBg:function(e){switch(e){case"hover":var t={border:"0px solid #666"};break;case"active":var t={border:"0px solid #666"};break;default:var t={border:"0px solid #efefef"}}this.border.setStyle(t).addClass("button-"+e)},checkNodes:function(e){var t=e;do if(this.options.tags&&bkLib.inArray(this.options.tags,t.nodeName)){this.activate();return true}while(t=t.parentNode&&"nicEdit"!=t.className);t=$BK(e);while(3==t.nodeType)t=$BK(t.parentNode);if(this.options.css)for(itm in this.options.css)if(t.getStyle(itm,this.ne.selectedInstance.instanceDoc)==this.options.css[itm]){this.activate();return true}this.deactivate();return false},activate:function(){if(!this.isDisabled){this.isActive=true;this.updateState();this.ne.fireEvent("buttonActivate",this)}},deactivate:function(){this.isActive=false;this.updateState();if(!this.isDisabled)this.ne.fireEvent("buttonDeactivate",this)},enable:function(e,t){this.isDisabled=false;this.contain.setStyle({opacity:1}).addClass("buttonEnabled");this.updateState();this.checkNodes(t)},disable:function(e,t){this.isDisabled=true;this.contain.setStyle({opacity:.6}).removeClass("buttonEnabled");this.updateState()},toggleActive:function(){this.isActive?this.deactivate():this.activate()},hoverOn:function(){if(!this.isDisabled){this.isHover=true;this.updateState();this.ne.fireEvent("buttonOver",this)}},hoverOff:function(){this.isHover=false;this.updateState();this.ne.fireEvent("buttonOut",this)},mouseClick:function(){if(this.options.command){this.ne.nicCommand(this.options.command,this.options.commandArgs);if(!this.options.noActive)this.toggleActive()}this.ne.fireEvent("buttonClick",this)},key:function(e,t){if(this.options.key&&t.ctrlKey&&String.fromCharCode(t.keyCode||t.charCode).toLowerCase()==this.options.key){this.mouseClick();if(t.preventDefault)t.preventDefault()}}});var nicPlugin=bkClass.extend({construct:function(e,t){this.options=t;this.ne=e;this.ne.addEvent("panel",this.loadPanel.closure(this));this.init()},loadPanel:function(e){var t=this.options.buttons;for(var n in t)e.addButton(n,this.options);e.reorder()},init:function(){}});var nicPaneOptions={};var nicEditorPane=bkClass.extend({construct:function(e,t,n,r){this.ne=t;this.elm=e;this.pos=e.pos();this.contain=(new bkElement("div")).setStyle({zIndex:"99999",overflow:"hidden",position:"absolute",left:this.pos[0]+"px",top:this.pos[1]+"px"});this.pane=(new bkElement("div")).setStyle({fontSize:"12px",border:"1px solid #ccc",backgroundColor:"#ccc",overflow:"hidden",padding:"4px",textAlign:"left"}).addClass("pane").setStyle(n).appendTo(this.contain);if(r&&!r.options.noClose)this.close=(new bkElement("div")).setStyle({"float":"right",height:"16px",width:"16px",cursor:"pointer"}).setStyle(this.ne.getIcon("close",nicPaneOptions)).addEvent("mousedown",r.removePane.closure(this)).appendTo(this.pane);this.contain.noSelect().appendTo(document.body);this.position();this.init()},init:function(){},position:function(){if(this.ne.nicPanel){var e=this.ne.nicPanel.elm;var t=e.pos();var n=t[0]+parseInt(e.getStyle("width"))-(parseInt(this.pane.getStyle("width"))+4);if(n<this.pos[0])this.contain.setStyle({left:n+"px"})}},toggle:function(){this.isVisible=!this.isVisible;this.contain.setStyle({display:this.isVisible?"block":"none"})},remove:function(){if(this.contain){this.contain.remove();this.contain=null}},append:function(e){e.appendTo(this.pane)},setContent:function(e){this.pane.setContent(e)}});var nicSelectOptions={buttons:{fontSize:{name:"Select Font Size",type:"nicEditorFontSizeSelect",command:"fontsize"},fontFamily:{name:"Select Font Family",type:"nicEditorFontFamilySelect",command:"fontname"},fontFormat:{name:"Select Font Format",type:"nicEditorFontFormatSelect",command:"formatBlock"}}};var nicEditorSelect=bkClass.extend({construct:function(e,t,n,r){this.options=n.buttons[t];this.elm=e;this.ne=r;this.name=t;this.selOptions=new Array;this.margin=(new bkElement("div")).setStyle({"float":"left",margin:"2px 1px 0 1px"}).appendTo(this.elm);this.contain=(new bkElement("div")).setStyle({width:"90px",height:"20px",cursor:"pointer",overflow:"hidden"}).addClass("selectContain").addEvent("click",this.toggle.closure(this)).appendTo(this.margin);this.items=(new bkElement("div")).setStyle({overflow:"hidden",zoom:1,border:"0px solid #ccc",paddingLeft:"3px"}).appendTo(this.contain);this.control=(new bkElement("div")).setStyle({overflow:"hidden","float":"right",height:"18px",width:"16px"}).addClass("selectControl").setStyle(this.ne.getIcon("arrow",n)).appendTo(this.items);this.txt=(new bkElement("div")).setStyle({color:"gray",overflow:"hidden","float":"left",width:"66px",height:"14px",marginTop:"1px",fontFamily:"sans-serif",textAlign:"center",fontSize:"12px"}).addClass("selectTxt").appendTo(this.items);if(!window.opera)this.contain.onmousedown=this.control.onmousedown=this.txt.onmousedown=bkLib.cancelEvent;this.margin.noSelect();this.ne.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this));this.disable();this.init()},disable:function(){this.isDisabled=true;this.close();this.contain.setStyle({opacity:.6})},enable:function(e){this.isDisabled=false;this.close();this.contain.setStyle({opacity:1})},setDisplay:function(e){this.txt.setContent(e)},toggle:function(){if(!this.isDisabled)this.pane?this.close():this.open()},open:function(){this.pane=new nicEditorPane(this.items,this.ne,{width:"88px",padding:"0px",borderTop:0,borderLeft:"1px solid #ccc",borderRight:"1px solid #ccc",borderBottom:"0px"});for(var e=0;e<this.selOptions.length;e++){var t=this.selOptions[e];var n=(new bkElement("div")).setStyle({overflow:"hidden",borderBottom:"1px solid #ccc",width:"88px",textAlign:"left",overflow:"hidden",cursor:"pointer"});var r=(new bkElement("div")).setStyle({padding:"0px 4px"}).setContent(t[1]).appendTo(n).noSelect();r.addEvent("click",this.update.closure(this,t[0])).addEvent("mouseover",this.over.closure(this,r)).addEvent("mouseout",this.out.closure(this,r)).setAttributes("id",t[0]);this.pane.append(n);if(!window.opera)r.onmousedown=bkLib.cancelEvent}},close:function(){if(this.pane)this.pane=this.pane.remove()},over:function(e){e.setStyle({})},out:function(e){e.setStyle({})},add:function(e,t){this.selOptions.push(new Array(e,t))},update:function(e){this.ne.nicCommand(this.options.command,e);this.close()}});var nicEditorFontSizeSelect=nicEditorSelect.extend({sel:{1:"1&nbsp;(8pt)",2:"2&nbsp;(10pt)",3:"3&nbsp;(12pt)",4:"4&nbsp;(14pt)",5:"5&nbsp;(18pt)",6:"6&nbsp;(24pt)"},init:function(){this.setDisplay("Font&nbsp;Size...");for(itm in this.sel)this.add(itm,'<font size="'+itm+'">'+this.sel[itm]+"</font>")}});var nicEditorFontFamilySelect=nicEditorSelect.extend({sel:{Acidic:"Acidic",Aight:"Aight",AaronHand:"AaronHand",Ballpark:"Ballpark",Zealot:"Zealot",Spinc:"Spinc",Spaceage:"Spaceage",Hardrock:"Hardrock",Blomster:"Blomster",Barbie:"Barbie",Walk:"Walk",Graffiti:"Graffiti",Thickhead:"Thickhead",StreetWriters:"StreetWriters",streetsoul:"streetsoul",Nosed:"Nosed",LydiaPuente:"LydiaPuente",DJGross:"DJGross",Whoa:"Whoa",FontBubble:"FontBubble",Amsterdam:"Amsterdam",Masterplan:"Masterplan",Tosca:"Tosca",Abite:"Abite",GraffitiPaintBrush:"GrfPaintBrush",Graffito:"Graffito",SubwayGr:"SubwayGr",Chunkfive:"Chunkfive",arial:"Arial","comic sans ms":"Comic Sans","courier new":"Courier New",georgia:"Georgia",helvetica:"Helvetica",impact:"Impact","times new roman":"Times","trebuchet ms":"Trebuchet",verdana:"Verdana"},init:function(){this.setDisplay("Font&nbsp;Family...");for(itm in this.sel)this.add(itm,'<font face="'+itm+'">'+this.sel[itm]+"</font>")}});var nicEditorFontFormatSelect=nicEditorSelect.extend({sel:{p:"Paragraph",pre:"Pre",h6:"Heading&nbsp;6",h5:"Heading&nbsp;5",h4:"Heading&nbsp;4",h3:"Heading&nbsp;3",h2:"Heading&nbsp;2",h1:"Heading&nbsp;1"},init:function(){this.setDisplay("Font&nbsp;Format...");for(itm in this.sel){var e=itm.toUpperCase();this.add("<"+e+">","<"+itm+' style="padding: 0px; margin: 0px;">'+this.sel[itm]+"</"+e+">")}}});nicEditors.registerPlugin(nicPlugin,nicSelectOptions);var nicButtonTips=bkClass.extend({construct:function(e){this.ne=e;e.addEvent("buttonOver",this.show.closure(this)).addEvent("buttonOut",this.hide.closure(this))},show:function(e){this.timer=setTimeout(this.create.closure(this,e),400)},create:function(e){this.timer=null;if(!this.pane){this.pane=new nicEditorPane(e.button,this.ne,{fontSize:"12px",marginTop:"5px"});this.pane.setContent(e.options.name)}},hide:function(e){if(this.timer)clearTimeout(this.timer);if(this.pane)this.pane=this.pane.remove()}});nicEditors.registerPlugin(nicButtonTips);var nicEditorAdvancedButton=nicEditorButton.extend({init:function(){this.ne.addEvent("selected",this.removePane.closure(this)).addEvent("blur",this.removePane.closure(this))},mouseClick:function(){if(!this.isDisabled)if(this.pane&&this.pane.pane)this.removePane();else{this.pane=new nicEditorPane(this.contain,this.ne,{width:this.width||"270px"},this);this.addPane();this.ne.selectedInstance.saveRng()}},addForm:function(e,t){this.form=(new bkElement("form")).addEvent("submit",this.submit.closureListener(this));this.pane.append(this.form);this.inputs={};for(itm in e){var n=e[itm];var r="";if(t)r=t.getAttribute(itm);if(!r)r=n.value||"";var i=e[itm].type;if("title"==i)(new bkElement("div")).setContent(n.txt).setStyle({fontSize:"14px",fontWeight:"bold",padding:"0px",margin:"2px 0"}).appendTo(this.form);else{var s=(new bkElement("div")).setStyle({overflow:"hidden",clear:"both"}).appendTo(this.form);if(n.txt)(new bkElement("label")).setAttributes({"for":itm}).setContent(n.txt).setStyle({margin:"2px 4px",fontSize:"13px",width:"50px",lineHeight:"20px",textAlign:"right","float":"left"}).appendTo(s);switch(i){case"text":this.inputs[itm]=(new bkElement("input")).setAttributes({id:itm,value:r,type:"text"}).setStyle({margin:"2px 0",fontSize:"13px","float":"left",height:"20px",border:"0px solid #ccc",overflow:"hidden"}).setStyle(n.style).appendTo(s);break;case"select":this.inputs[itm]=(new bkElement("select")).setAttributes({id:itm}).setStyle({border:"0px solid #ccc","float":"left",margin:"2px 0"}).appendTo(s);for(opt in n.options)var o=(new bkElement("option")).setAttributes({value:opt,selected:opt==r?"selected":""}).setContent(n.options[opt]).appendTo(this.inputs[itm]);break;case"content":this.inputs[itm]=(new bkElement("textarea")).setAttributes({id:itm}).setStyle({border:"0px solid #ccc","float":"left"}).setStyle(n.style).appendTo(s);this.inputs[itm].value=r}}}(new bkElement("input")).setAttributes({type:"submit"}).setStyle({border:"0px solid #ccc",margin:"3px 0","float":"left",clear:"both"}).appendTo(this.form);this.form.onsubmit=bkLib.cancelEvent},submit:function(){},findElm:function(e,t,n){var r=this.ne.selectedInstance.getElm().getElementsByTagName(e);for(var i=0;i<r.length;i++)if(r[i].getAttribute(t)==n)return $BK(r[i])},removePane:function(){if(this.pane){this.pane.remove();this.pane=null;this.ne.selectedInstance.restoreRng()}}});var nicLinkOptions={buttons:{link:{name:"Add Link",type:"nicLinkButton",tags:["A"]},unlink:{name:"Remove Link",command:"unlink",noActive:true}}};var nicLinkButton=nicEditorAdvancedButton.extend({addPane:function(){this.ln=this.ne.selectedInstance.selElm().parentTag("A");this.addForm({"":{type:"title",txt:"Add/Edit Link"},href:{type:"text",txt:"URL",value:"http://",style:{width:"150px"}},title:{type:"text",txt:"Title"},target:{type:"select",txt:"Open In",options:{"":"Current Window",_blank:"New Window"},style:{width:"100px"}}},this.ln)},submit:function(e){var t=this.inputs.href.value;if("http://"==t||""==t){alert("You must enter a URL to Create a Link");return false}this.removePane();if(!this.ln){var n="javascript:nicTemp();";this.ne.nicCommand("createlink",n);this.ln=this.findElm("A","href",n)}if(this.ln)this.ln.setAttributes({href:this.inputs.href.value,title:this.inputs.title.value,target:this.inputs.target.options[this.inputs.target.selectedIndex].value})}});nicEditors.registerPlugin(nicPlugin,nicLinkOptions);var nicColorOptions={buttons:{forecolor:{name:__("Change Text Color"),type:"nicEditorColorButton",noClose:true},bgcolor:{name:__("Change Background Color"),type:"nicEditorBgColorButton",noClose:true}}};var nicEditorColorButton=nicEditorAdvancedButton.extend({addPane:function(){var e={0:"00",1:"33",2:"66",3:"99",4:"CC",5:"FF"};var t=(new bkElement("DIV")).setStyle({width:"270px"});for(var n in e)for(var r in e)for(var i in e){var s="#"+e[n]+e[i]+e[r];var o=(new bkElement("DIV")).setStyle({cursor:"pointer",height:"15px","float":"left"}).appendTo(t);var u=(new bkElement("DIV")).setStyle({border:"2px solid "+s}).appendTo(o);var a=(new bkElement("DIV")).setStyle({backgroundColor:s,overflow:"hidden",width:"11px",height:"11px"}).addEvent("click",this.colorSelect.closure(this,s)).addEvent("mouseover",this.on.closure(this,u)).addEvent("mouseout",this.off.closure(this,u,s)).appendTo(u);if(!window.opera)o.onmousedown=a.onmousedown=bkLib.cancelEvent}this.pane.append(t.noSelect())},colorSelect:function(e){this.ne.nicCommand("foreColor",e);this.removePane()},on:function(e){e.setStyle({border:"2px solid #FFF"})},off:function(e,t){e.setStyle({border:"2px solid "+t})}});var nicEditorBgColorButton=nicEditorColorButton.extend({colorSelect:function(e){this.ne.nicCommand("hiliteColor",e);this.removePane()}});nicEditors.registerPlugin(nicPlugin,nicColorOptions);var nicImageOptions={buttons:{image:{name:"Add Image",type:"nicImageButton",tags:["IMG"]}}};var nicImageButton=nicEditorAdvancedButton.extend({addPane:function(){this.im=this.ne.selectedInstance.selElm().parentTag("IMG");this.addForm({"":{type:"title",txt:"Add/Edit Image"},src:{type:"text",txt:"URL",value:"http://",style:{width:"150px"}},alt:{type:"text",txt:"Alt Text",style:{width:"100px"}},align:{type:"select",txt:"Align",options:{none:"Default",left:"Left",right:"Right"}}},this.im)},submit:function(e){var t=this.inputs.src.value;if(""==t||"http://"==t){alert("You must enter a Image URL to insert");return false}this.removePane();if(!this.im){var n="javascript:nicImTemp();";this.ne.nicCommand("insertImage",n);this.im=this.findElm("IMG","src",n)}if(this.im)this.im.setAttributes({src:this.inputs.src.value,alt:this.inputs.alt.value,align:this.inputs.align.value})}});nicEditors.registerPlugin(nicPlugin,nicImageOptions);var nicSaveOptions={buttons:{save:{name:__("Save this content"),type:"nicEditorSaveButton"}}};var nicEditorSaveButton=nicEditorButton.extend({init:function(){if(!this.ne.options.onSave)this.margin.setStyle({display:"none"})},mouseClick:function(){var e=this.ne.options.onSave;var t=this.ne.selectedInstance;e(t.getContent(),t.elm.id,t)}});nicEditors.registerPlugin(nicPlugin,nicSaveOptions);var nicXHTML=bkClass.extend({stripAttributes:["_moz_dirty","_moz_resizing","_extended"],noShort:["style","title","script","textarea","a"],cssReplace:{"font-weight:bold;":"strong","font-style:italic;":"em"},sizes:{1:"xx-small",2:"x-small",3:"small",4:"medium",5:"large",6:"x-large"},construct:function(e){this.ne=e;if(this.ne.options.xhtml)e.addEvent("get",this.cleanup.closure(this))},cleanup:function(e){var t=e.getElm();var n=this.toXHTML(t);e.content=n},toXHTML:function(e,t,n){var r="";var i="";var s="";var o=e.nodeType;var u=e.nodeName.toLowerCase();var a=e.hasChildNodes&&e.hasChildNodes();var f=new Array;switch(o){case 1:var l=e.attributes;switch(u){case"b":u="strong";break;case"i":u="em";break;case"font":u="span"}if(t){for(var c=0;c<l.length;c++){var h=l[c];var p=h.nodeName.toLowerCase();var d=h.nodeValue;if(!h.specified||!d||bkLib.inArray(this.stripAttributes,p)||"function"==typeof d)continue;switch(p){case"style":var v=d.replace(/ /g,"");for(itm in this.cssReplace)if(v.indexOf(itm)!=-1){f.push(this.cssReplace[itm]);v=v.replace(itm,"")}s+=v;d="";break;case"class":d=d.replace("Apple-style-span","");break;case"size":s+="font-size:"+this.sizes[d]+";";d=""}if(d)i+=" "+p+'="'+d+'"'}if(s)i+=' style="'+s+'"';for(var c=0;c<f.length;c++)r+="<"+f[c]+">";if(""==i&&"span"==u)t=false;if(t){r+="<"+u;if("br"!=u)r+=i}}if(!a&&!bkLib.inArray(this.noShort,p)){if(t)r+=" />"}else{if(t)r+=">";for(var c=0;c<e.childNodes.length;c++){var m=this.toXHTML(e.childNodes[c],true,true);if(m)r+=m}}if(t&&a)r+="</"+u+">";for(var c=0;c<f.length;c++)r+="</"+f[c]+">";break;case 3:r+=e.nodeValue}return r}});nicEditors.registerPlugin(nicXHTML);var nicCodeOptions={buttons:{xhtml:{name:"Edit HTML",type:"nicCodeButton"}}};var nicCodeButton=nicEditorAdvancedButton.extend({width:"350px",addPane:function(){this.addForm({"":{type:"title",txt:"Edit HTML"},code:{type:"content",value:this.ne.selectedInstance.getContent(),style:{width:"340px",height:"200px"}}})},submit:function(e){var t=this.inputs.code.value;this.ne.selectedInstance.setContent(t);this.removePane()}});nicEditors.registerPlugin(nicPlugin,nicCodeOptions);var nicBBCode=bkClass.extend({construct:function(e){this.ne=e;if(this.ne.options.bbCode){e.addEvent("get",this.bbGet.closure(this));e.addEvent("set",this.bbSet.closure(this));var t=this.ne.loadedPlugins;for(itm in t)if(t[itm].toXHTML)this.xhtml=t[itm]}},bbGet:function(e){var t=this.xhtml.toXHTML(e.getElm());e.content=this.toBBCode(t)},bbSet:function(e){e.content=this.fromBBCode(e.content)},toBBCode:function(e){function t(t,n){e=e.replace(t,n)}t(/\n/gi,"");t(/<strong>(.*?)<\/strong>/gi,"[b]$1[/b]");t(/<em>(.*?)<\/em>/gi,"[i]$1[/i]");t(/<span.*?style="text-decoration:underline;">(.*?)<\/span>/gi,"[u]$1[/u]");t(/<ul>(.*?)<\/ul>/gi,"[list]$1[/list]");t(/<li>(.*?)<\/li>/gi,"[*]$1[]");t(/<ol>(.*?)<\/ol>/gi,"[list=1]$1[/list]");t(/<img.*?src="(.*?)".*?>/gi,"[img]$1[/img]");t(/<a.*?href="(.*?)".*?>(.*?)<\/a>/gi,"[url=$1]$2[/url]");t(/<br.*?>/gi,"\n");t(/<.*?>.*?<\/.*?>/gi,"");return e},fromBBCode:function(e){function t(t,n){e=e.replace(t,n)}t(/\[b\](.*?)\[\/b\]/gi,"<strong>$1</strong>");t(/\[i\](.*?)\[\/i\]/gi,"<em>$1</em>");t(/\[u\](.*?)\[\/u\]/gi,'<span style="text-decoration:underline;">$1</span>');t(/\[list\](.*?)\[\/list\]/gi,"<ul>$1</ul>");t(/\[list=1\](.*?)\[\/list\]/gi,"<ol>$1</ol>");t(/\[\*\](.*?)\[\/\*\]/gi,"<li>$1</li>");t(/\[img\](.*?)\[\/img\]/gi,'<img src="$1" />');t(/\[url=(.*?)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>');t(/\n/gi,"<br />");return e}});nicEditors.registerPlugin(nicBBCode);var nicUploadOptions={buttons:{upload:{name:"Upload Image",type:"nicUploadButton"}}};var nicUploadButton=nicEditorAdvancedButton.extend({nicURI:"http://api.imgur.com/2/upload.json",errorText:"Failed to upload image",addPane:function(){if("undefined"===typeof window.FormData)return this.onError("Image uploads are not supported in this browser, use Chrome, Firefox, or Safari instead.");this.im=this.ne.selectedInstance.selElm().parentTag("IMG");var e=(new bkElement("div")).setStyle({padding:"10px"}).appendTo(this.pane.pane);(new bkElement("div")).setStyle({fontSize:"14px",fontWeight:"bold",paddingBottom:"5px"}).setContent("Insert an Image").appendTo(e);this.fileInput=(new bkElement("input")).setAttributes({type:"file"}).appendTo(e);this.progress=(new bkElement("progress")).setStyle({width:"100%",display:"none"}).setAttributes("max",100).appendTo(e);this.fileInput.onchange=this.uploadFile.closure(this)},onError:function(e){this.removePane();alert(e||"Failed to upload image")},uploadFile:function(){var e=this.fileInput.files[0];if(!e||!e.type.match(/image.*/)){this.onError("Only image files can be uploaded");return}this.fileInput.setStyle({display:"none"});this.setProgress(0);var t=new FormData;t.append("image",e);t.append("key","b7ea18a4ecbda8e92203fa4968d10660");var n=new XMLHttpRequest;n.open("POST",this.ne.options.uploadURI||this.nicURI);n.onload=function(){try{var e=JSON.parse(n.responseText)}catch(t){return this.onError()}this.onUploaded(e.upload)}.closure(this);n.onerror=this.onError.closure(this);n.upload.onprogress=function(e){this.setProgress(e.loaded/e.total)}.closure(this);n.send(t)},setProgress:function(e){this.progress.setStyle({display:"block"});if(e<.98)this.progress.value=e;else this.progress.removeAttribute("value")},onUploaded:function(e){this.removePane();var t=e.links.original;if(!this.im){this.ne.selectedInstance.restoreRng();var n="javascript:nicImTemp();";this.ne.nicCommand("insertImage",t);this.im=this.findElm("IMG","src",t)}var r=parseInt(this.ne.selectedInstance.elm.getStyle("width"));if(this.im)this.im.setAttributes({src:t,width:r&&e.image.width?Math.min(r,e.image.width):""})}});nicEditors.registerPlugin(nicPlugin,nicUploadOptions)